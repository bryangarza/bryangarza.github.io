<!DOCTYPE html>
<html>
<head>
<!-- 2016-06-23 Thu 12:57 -->
<meta  charset="utf-8">
<meta  name="viewport" content="width=device-width, initial-scale=1">
<title>Home</title>
<meta  name="generator" content="Org-mode">
<meta  name="author" content="Bryan Garza">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>

<link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
<link href="./css/styles2.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="./css/styles.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
<h1 class="title"><a href="http://bryangarza.github.io">val bryan : sushi -> emacs -> code </a></h1>
</div>
<div id="content">
<p>
I&rsquo;m a software engineer interested in {programming, foreign} languages and
distributed systems. You&rsquo;ll often find me hacking on Haskell, Racket, and Emacs
Lisp. (<a href="https://github.com/bryangarza">GitHub</a>, <a href="https://keybase.io/bryangarza">Keybase</a>, <a href="mailto:brygarza@gmail.com">Contact</a>, <a href="http://themattchan.com/plquotes.html">PL quotes</a>)
</p>

<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1">All Posts <span class="archive"><a href="http://bryangarza.github.io/archive.html">(Archive)</a></span></h2>
<div class="outline-text-2" id="text-orgheadline1">
<div class="outline-3"><h3><a href="./exploring-racket-forms-define-and-letrec.html">Exploring Racket Forms: define and letrec</a><span> </span><span class="timestamp-wrapper"><span class="timestamp">(March 11, 2016)</span></span></h3>
<p>
A couple weeks ago I was trying to understand why expressions like this were
valid:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">future-bound</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-function-name">f</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>+ x 1<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">define</span> <span class="org-function-name">x</span> 5<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>f<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
Why can you define the <code>x</code> after its usage in <code>f</code>? I initially thought that <code>define</code>
desugared into nested <code>let</code>&rsquo;s or perhaps <code>let*</code>, like this:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">[</span>f <span class="org-rainbow-delimiters-depth-4">(</span>+ x 1<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">]</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-4">[</span>x 5<span class="org-rainbow-delimiters-depth-4">]</span><span class="org-rainbow-delimiters-depth-3">)</span>
    f<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">[</span>f <span class="org-rainbow-delimiters-depth-4">(</span>+ x 1<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">]</span>
       <span class="org-rainbow-delimiters-depth-3">[</span>x 5<span class="org-rainbow-delimiters-depth-3">]</span><span class="org-rainbow-delimiters-depth-2">)</span>
  f<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
But neither made sense, since we still have the same problem of <code>x</code> being bound
after <code>f</code> is bound. It turns out that <code>define</code> desugars into <code>letrec</code>:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">letrec</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">[</span>f <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-keyword">&#955;</span> <span class="org-rainbow-delimiters-depth-5">()</span> <span class="org-rainbow-delimiters-depth-5">(</span>+ x 1<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">]</span>
         <span class="org-rainbow-delimiters-depth-3">[</span>x 5<span class="org-rainbow-delimiters-depth-3">]</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>f<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
This works because <code>letrec</code> initializes the bindings for each of the symbols, to
something akin to <code>undefined</code>. After that, all bindings are initialized to their
values at once. This allows bindings to reference others before those bindings&rsquo;
definitions exist. The value of <code>x</code> in <code>f</code> is only looked up once <code>f</code> is
evaluated. We&rsquo;re referencing symbols statically, but the lookup is dynamic. That
means anything any symbols referencing symbols that come after have to be
wrapped in a <code>lambda</code>; if you try to look up too early, it won&rsquo;t work.
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span class="org-comment-delimiter">; </span><span class="org-comment">Trying to reference a value immediately</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">letrec</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">[</span>six <span class="org-rainbow-delimiters-depth-4">(</span>+ x 1<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">]</span>
         <span class="org-rainbow-delimiters-depth-3">[</span>x 5<span class="org-rainbow-delimiters-depth-3">]</span><span class="org-rainbow-delimiters-depth-2">)</span>
  #t<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
Result:
</p>

<div class="org-src-container">

<pre class="src src-example">Error: struct:exn:fail:contract:variable

x: undefined;
 cannot use before initialization
</pre>
</div>

<p>
You can see this fails at the point that we try to look up <code>x</code> during the binding
of <code>six</code>. Now using a <code>lambda</code> (and with <code>let</code> since it behaves in the same way and
this example only binds one symbol anyways):
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span class="org-comment-delimiter">; </span><span class="org-comment">loophole?</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">[</span>f <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-keyword">&#955;</span> <span class="org-rainbow-delimiters-depth-5">()</span> <span class="org-rainbow-delimiters-depth-5">(</span>+ x 1<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">]</span><span class="org-rainbow-delimiters-depth-2">)</span>
  f<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
Here, <code>x</code> isn&rsquo;t bound anywhere, but <code>f</code> can still be bound and returned! But if we
actually try to evaluate <code>f</code>, we&rsquo;ll run into problems.
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span class="org-comment-delimiter">; </span><span class="org-comment">=&gt; Error: struct:exn:fail:contract</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">[</span>f <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-keyword">&#955;</span> <span class="org-rainbow-delimiters-depth-5">()</span> <span class="org-rainbow-delimiters-depth-5">(</span>+ x 1<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">]</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>f<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
</div>

<div class="outline-3"><h3><a href="./dynamic-scope-in-racket.html">Dynamic Scope In Racket</a><span> </span><span class="timestamp-wrapper"><span class="timestamp">(March 10, 2016)</span></span></h3>
<p>
One way to do dynamic scope is with <a href="https://www.gnu.org/software/mit-scheme/documentation/mit-scheme-ref/Dynamic-Binding.html">fluid-let</a>, which basically reassigns the
value of a variable instead of creating a shadow, but though this is available
in Scheme, it&rsquo;s not available in Racket.
</p>

<p>
Racket has a form named <a href="https://docs.racket-lang.org/guide/parameterize.html">parameterize</a>, that allows you to pass variables
dynamically, but forces you to set a default value.
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-function-name">x</span> <span class="org-rainbow-delimiters-depth-2">(</span>make-parameter 2<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">incr-x</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>+ <span class="org-rainbow-delimiters-depth-3">(</span>x<span class="org-rainbow-delimiters-depth-3">)</span> 1<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">dynamic-x</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">parameterize</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-4">[</span>x 5<span class="org-rainbow-delimiters-depth-4">]</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>incr-x<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
<code>make-parameter</code> creates a function <code>x</code> that returns the value. Evaluating <code>(x)</code>
results in <code>2</code>.
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span class="org-rainbow-delimiters-depth-1">(</span>incr-x<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-comment-delimiter">;</span><span class="org-comment">=&gt; 3</span>
</pre>
</div>

<p>
However, you can associate a new value to the <code>x</code> parameter using <code>parameterize</code>:
</p>

<div class="org-src-container">

<pre class="src src-scheme"><span class="org-rainbow-delimiters-depth-1">(</span>dynamic-x<span class="org-rainbow-delimiters-depth-1">)</span> <span class="org-comment-delimiter">;</span><span class="org-comment">=&gt; 6</span>
</pre>
</div>

<p>
An advantage of <code>parameterize</code> over imperative updates of parameter values is
that the implementation is thread-safe, and continuation-friendly. There are a
few other pluses in addition to that, which you can check out in the docs.
</p>
</div>

<div class="outline-3"><h3><a href="./s-expressions-as-a-lightweight-serialization-format.html">S-expressions as a Lightweight Serialization Format</a><span> </span><span class="timestamp-wrapper"><span class="timestamp">(February 17, 2016)</span></span></h3>
<p>
I&rsquo;ve been writing a desktop application that uses OCaml for the backend, and
Racket for the GUI frontend. To communicate between the two, I call the OCaml
program as a subprocess from Racket, and have s-expressions be the serialization
mechanism that both languages can understand. Jane Street&rsquo;s <a href="https://github.com/janestreet/core">Core</a>, along with the
<code>sexplib</code> syntax extension mentioned in my previous post, offer an easy way to
translate OCaml types to sexps that Racket can then read.
</p>

<p>
With a type like:
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">type</span> <span class="org-type">book</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-1">{</span></span>
  title        <span class="org-tuareg-font-lock-operator">:</span> string<span class="org-tuareg-font-lock-operator">;</span>
  authors      <span class="org-tuareg-font-lock-operator">:</span> string list<span class="org-tuareg-font-lock-operator">;</span>
  pubdate      <span class="org-tuareg-font-lock-operator">:</span> string<span class="org-tuareg-font-lock-operator">;</span>
  publishers   <span class="org-tuareg-font-lock-operator">:</span> string list<span class="org-tuareg-font-lock-operator">;</span>
  subjects     <span class="org-tuareg-font-lock-operator">:</span> string list
<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-1">}</span></span> <span class="org-keyword">with</span> sexp
</pre>
</div>

<p>
A <code>sexp_of_book</code> function is automatically generated.
</p>

<p>
Now racket can receive:
</p>
<div class="org-src-container">

<pre class="src src-scheme">'<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>title <span class="org-string">"Purely functional data structures"</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>authors <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"Chris Okasaki"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>pubdate 1999<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>publishers <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"Cambridge University Press"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>subjects <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"Functional programming languages"</span> <span class="org-string">"Data structures (Computer science)"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
I take this sexp, and create a <code>book</code> struct:
</p>
<div class="org-src-container">

<pre class="src src-scheme"><span class="org-rainbow-delimiters-depth-1">(</span>struct book <span class="org-rainbow-delimiters-depth-2">(</span>title authors pubdate publishers subjects<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-function-name">isbn-lookup</span> isbn<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-4">[</span>cmd <span class="org-rainbow-delimiters-depth-5">(</span>string-join <span class="org-rainbow-delimiters-depth-6">(</span>list homelib-binary isbn<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">]</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-4">(</span><span class="org-keyword">&#955;</span>~&gt;&gt; process    <span class="org-comment-delimiter">; </span><span class="org-comment">-&gt; '(stdout stdin proc-id stderr f)</span>
           car
           read       <span class="org-comment-delimiter">; </span><span class="org-comment">from an input port</span>
           <span class="org-rainbow-delimiters-depth-5">(</span><span class="org-keyword">map</span> cadr<span class="org-rainbow-delimiters-depth-5">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">(k v) -&gt; v</span>
           <span class="org-rainbow-delimiters-depth-5">(</span>apply book<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
     cmd<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
Finally, we can test it out on the REPL to make sure it works:
</p>
<div class="org-src-container">

<pre class="src src-scheme">racket@app.rkt&gt; <span class="org-rainbow-delimiters-depth-1">(</span>isbn-lookup <span class="org-string">"0521663504"</span><span class="org-rainbow-delimiters-depth-1">)</span>
#&lt;book&gt;

racket@app.rkt&gt; <span class="org-rainbow-delimiters-depth-1">(</span>book-title <span class="org-rainbow-delimiters-depth-2">(</span>isbn-lookup <span class="org-string">"0521663504"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-string">"Purely functional data structures"</span>

racket@app.rkt&gt; <span class="org-rainbow-delimiters-depth-1">(</span>book-subjects <span class="org-rainbow-delimiters-depth-2">(</span>isbn-lookup <span class="org-string">"0521663504"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
'<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-string">"Functional programming languages"</span> <span class="org-string">"Data structures (Computer science)"</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
Similarly, I can work in the other direction, and pass Racket s-expressions to
OCaml, and using sexplib, convert them back to OCaml types. What a time to be
alive!
</p>
</div>

<div class="outline-3"><h3><a href="./adding-syntax-extensions-to-an-ocaml-project.html">Adding Syntax Extensions To An OCaml Project</a><span> </span><span class="timestamp-wrapper"><span class="timestamp">(February 8, 2016)</span></span></h3>
<p>
Here&rsquo;s the set of steps needed to start using syntax extensions. I&rsquo;ll be using
<a href="https://github.com/janestreet/sexplib">sexplib</a> as the example.
</p>

<p>
First, you have to add the extension to your <code>.merlin</code> file:
</p>
<pre class="example">
PKG core yojson lwt cohttp cohttp.lwt
EXT sexplib.syntax
</pre>

<p>
Now Merlin&rsquo;s minor mode won&rsquo;t throw up errors when you save. Next up is
compiling the project. I&rsquo;m using <a href="http://oasis.forge.ocamlcore.org/">Oasis</a>. Add <code>sexplib</code> and its <code>.syntax</code> file to the
<code>BuildDepends</code> in the <code>_oasis</code> file:
</p>

<pre class="example">
(other stuff)

Executable myprogram
  Path: src
  BuildTools: ocamlbuild
  MainIs: main.ml
  CompiledObject: best
  BuildDepends:
    core,
&gt;   sexplib,
&gt;   sexplib.syntax,
    threads,
    yojson,
    lwt,
    cohttp,
    cohttp.lwt
</pre>

<p>
After that, call <code>oasis</code> to add in the new dependencies. I use
</p>
<pre class="example">
oasis setup -setup-update dynamic
</pre>

<p>
Run <code>make</code> again, and the project should build using <code>sexplib</code>!
</p>
</div>

<div class="outline-3"><h3><a href="./on-the-importance-of-enforcing-invariants.html">On The Importance Of Enforcing Invariants</a><span> </span><span class="timestamp-wrapper"><span class="timestamp">(February 4, 2016)</span></span></h3>
<p>
Something that comes up early on when learning OCaml is the topic of abstract
types. Comparable to &ldquo;encapsulation&rdquo; in object-oriented programming, one purpose
of abstract types is to protect the programmer from misusing a module&rsquo;s
types. By abstracting the type, for example, presenting a <code>Number.t</code> instead of a
plain <code>int</code> type, the underlying implementation can be swapped out, without
affecting code using the module. Only by using the module can the user create a
value of that type, because only the module knows that <code>Number.t = int</code>, and has
ability to create that type.
</p>

<p>
Abstract types guarantee that the user can never access the concrete type
directly This is known as &ldquo;enforcing invariants&rdquo;, preserving certain properties
about the type, so that you can now assume they will always be true, i.e.,
<i>invariant</i>.  Placing this restriction on library users increases the level of
type safety significantly.
</p>

<p>
On the other hand, sometimes you <i>do</i> want to have concrete types in your
interface, and that&rsquo;s okay too. It gives more flexibility to the user, since
they can construct those types by hand, and have more detail about the internals
of the module.
</p>
</div>

<div class="outline-3">
<h3><a href="./universal-quantification-in-ocaml.html">Universal Quantification in OCaml</a> <span class="timestamp-wrapper"><span class="timestamp">(February 2, 2016)</span></span></h3>
<p>
The difference between OCaml&rsquo;s type signatures and type annotations is quite
subtle. First of all, signatures are what you put in the mli files, whereas
annotations are inline with your code. When you write a function like:
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">foo</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-type">'a </span><span class="org-tuareg-font-lock-operator">-&gt;</span><span class="org-type"> 'a </span><span class="org-tuareg-font-lock-operator">=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">x</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 0
</pre>
</div>
<p>
the type of <code>foo</code> resolves to <code>int -&gt; int</code>, because <code>'a</code> is
serving as a unification variable and not a type parameter. In order to force
the compiler to not constrain the function to the concrete type <code>int</code>, you need
to annotate:
</p>
<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">foo</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-type">'a. 'a </span><span class="org-tuareg-font-lock-operator">-&gt;</span><span class="org-type"> 'a </span><span class="org-tuareg-font-lock-operator">=</span> <span class="org-keyword">fun</span> <span class="org-variable-name">x</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> 0
</pre>
</div>
<p>
Essentially, this means &ldquo;for all types &lsquo;a&rdquo;, and now we are dealing with a type
parameter instead, forcing the compiler to keep the function polymorphic. The
mli files work with type parameters by default, so if you are writing type
signatures there you might not run into this problem. However, sometimes your
function will not typecheck (because it&rsquo;s unclear) until you annotate it with
the type ascription, and you&rsquo;ll need to do that before the mli can be checked by
the compiler.
</p>

<p>
There&rsquo;s some more info about this on <a href="http://stackoverflow.com/questions/23323032/in-ocaml-what-type-definition-is-this-a-unit-a">SO</a> and <a href="https://blogs.janestreet.com/ensuring-that-a-function-is-polymorphic-in-ocaml-3-12/">Jane Street&rsquo;s blog</a>.
</p>
</div>

<div class="outline-3"><h3><a href="./automating-blog-posts-with-org-mode.html">Automating Blog Posts With Org-mode</a><span> </span><span class="timestamp-wrapper"><span class="timestamp">(January 31, 2016)</span></span></h3>
<p>
The best way to get me writing is to remove all barriers that slow me down. This
especially includes the setup of creating a new post in <code>org-mode</code> and writing its
index entry. It might be really easy but it&rsquo;s annoying to have to do this every
time for each new post. So I whipped up some elisp that does all of this for
me. It just takes the title, keywords, and description of the post, and takes
care of the rest.
</p>

<div class="org-src-container">

<pre class="src src-elisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">bryan/blog-new-post</span> <span class="org-rainbow-delimiters-depth-2">(</span>title keywords description<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Create a new post"</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>interactive <span class="org-string">"sTitle: \nsKeywords: \nsDescription: "</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">(message "Keywords are: %s" keywords)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-4">(</span>filename-prepared <span class="org-rainbow-delimiters-depth-5">(</span>string-trim
                             <span class="org-rainbow-delimiters-depth-6">(</span>replace-regexp-in-string <span class="org-string">" "</span> <span class="org-string">"-"</span> <span class="org-rainbow-delimiters-depth-7">(</span>downcase title<span class="org-rainbow-delimiters-depth-7">)</span><span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
         <span class="org-rainbow-delimiters-depth-4">(</span>relfile <span class="org-rainbow-delimiters-depth-5">(</span>concat filename-prepared <span class="org-string">".org"</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
         <span class="org-rainbow-delimiters-depth-4">(</span>relfile-html <span class="org-rainbow-delimiters-depth-5">(</span>concat <span class="org-string">"./"</span> filename-prepared <span class="org-string">".html"</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
         <span class="org-rainbow-delimiters-depth-4">(</span>absfile <span class="org-rainbow-delimiters-depth-5">(</span>concat bryan/blog-blogdir relfile<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
         <span class="org-rainbow-delimiters-depth-4">(</span>date <span class="org-rainbow-delimiters-depth-5">(</span>format-time-string <span class="org-string">"[%Y-%m-%d %a]"</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
         <span class="org-rainbow-delimiters-depth-4">(</span>date-day-not-padded <span class="org-rainbow-delimiters-depth-5">(</span>string-trim <span class="org-rainbow-delimiters-depth-6">(</span>format-time-string <span class="org-string">"%e"</span><span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
         <span class="org-rainbow-delimiters-depth-4">(</span>mon <span class="org-rainbow-delimiters-depth-5">(</span>format-time-string <span class="org-string">"%B"</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
         <span class="org-rainbow-delimiters-depth-4">(</span>yr <span class="org-rainbow-delimiters-depth-5">(</span>format-time-string <span class="org-string">"%Y"</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
         <span class="org-rainbow-delimiters-depth-4">(</span>date-human-readable
          <span class="org-rainbow-delimiters-depth-5">(</span>concat <span class="org-string">"("</span> mon <span class="org-rainbow-delimiters-depth-6">(</span>format <span class="org-string">" %s, "</span> date-day-not-padded<span class="org-rainbow-delimiters-depth-6">)</span> yr <span class="org-string">")"</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
         <span class="org-rainbow-delimiters-depth-4">(</span>my-html-link-and-span
          `<span class="org-rainbow-delimiters-depth-5">(</span>,<span class="org-rainbow-delimiters-depth-6">(</span>html-a
              <span class="org-builtin">:href</span> relfile-html title<span class="org-rainbow-delimiters-depth-6">)</span>
            ,<span class="org-rainbow-delimiters-depth-6">(</span>html-span <span class="org-string">" "</span><span class="org-rainbow-delimiters-depth-6">)</span>
            ,<span class="org-rainbow-delimiters-depth-6">(</span>html-span
              <span class="org-builtin">:class</span> <span class="org-string">"timestamp-wrapper"</span>
              <span class="org-rainbow-delimiters-depth-7">(</span>html-span
               <span class="org-builtin">:class</span> <span class="org-string">"timestamp"</span>
               date-human-readable<span class="org-rainbow-delimiters-depth-7">)</span><span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>

    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">with-current-buffer</span> <span class="org-rainbow-delimiters-depth-4">(</span>find-file-noselect bryan/blog-indexfile<span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>goto-char <span class="org-rainbow-delimiters-depth-5">(</span>point-min<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>search-forward <span class="org-string">"&gt;@@"</span><span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>insert <span class="org-string">"\n#+BEGIN_HTML\n"</span><span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>html-lite-write-tree-single-line
       <span class="org-rainbow-delimiters-depth-5">(</span>butlast
        <span class="org-rainbow-delimiters-depth-6">(</span>html-div
         <span class="org-builtin">:class</span> <span class="org-string">"outline-3"</span>
         <span class="org-rainbow-delimiters-depth-7">(</span>html-h3
          my-html-link-and-span<span class="org-rainbow-delimiters-depth-7">)</span><span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>insert <span class="org-string">"\n#+END_HTML\n"</span><span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>insert <span class="org-rainbow-delimiters-depth-5">(</span>format <span class="org-string">"#+INCLUDE: \"%s\" :lines \"11-\""</span> relfile<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>insert <span class="org-rainbow-delimiters-depth-5">(</span>bryan/org-escape-html <span class="org-string">"&lt;/div&gt;"</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-keyword">with-temp-message</span> <span class="org-rainbow-delimiters-depth-5">(</span>format <span class="org-string">"Writing to %s"</span> bryan/blog-indexfile<span class="org-rainbow-delimiters-depth-5">)</span>
        <span class="org-rainbow-delimiters-depth-5">(</span>save-buffer<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>message <span class="org-string">"Writing file...done"</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>

    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">with-temp-buffer</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>-each `<span class="org-rainbow-delimiters-depth-5">(</span>,<span class="org-rainbow-delimiters-depth-6">(</span>format <span class="org-string">"#+TITLE: %s\n"</span> title<span class="org-rainbow-delimiters-depth-6">)</span>
               ,<span class="org-rainbow-delimiters-depth-6">(</span>format <span class="org-string">"#+DATE: %s\n"</span> date<span class="org-rainbow-delimiters-depth-6">)</span>
               ,<span class="org-rainbow-delimiters-depth-6">(</span>format <span class="org-string">"#+KEYWORDS: %s\n"</span> keywords<span class="org-rainbow-delimiters-depth-6">)</span>
               ,<span class="org-rainbow-delimiters-depth-6">(</span>format <span class="org-string">"#+DESCRIPTION: %s\n"</span> description<span class="org-rainbow-delimiters-depth-6">)</span>
               <span class="org-string">"#+OPTIONS: title:nil\n\n"</span>
               <span class="org-string">"#+BEGIN_HTML\n"</span><span class="org-rainbow-delimiters-depth-5">)</span>
        #'insert<span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>html-lite-write-tree-single-line
       <span class="org-rainbow-delimiters-depth-5">(</span>html-header
        <span class="org-rainbow-delimiters-depth-6">(</span>html-h1 <span class="org-builtin">:class</span> <span class="org-string">"title"</span> my-html-link-and-span<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>insert <span class="org-string">"\n#+END_HTML\n\n"</span><span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-keyword">when</span> <span class="org-rainbow-delimiters-depth-5">(</span>file-writable-p absfile<span class="org-rainbow-delimiters-depth-5">)</span>
        <span class="org-rainbow-delimiters-depth-5">(</span>write-region <span class="org-rainbow-delimiters-depth-6">(</span>point-min<span class="org-rainbow-delimiters-depth-6">)</span>
                      <span class="org-rainbow-delimiters-depth-6">(</span>point-max<span class="org-rainbow-delimiters-depth-6">)</span>
                      absfile<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>find-file absfile<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>goto-char <span class="org-rainbow-delimiters-depth-3">(</span>point-max<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>message <span class="org-string">"Generated template"</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
</div>

<div class="outline-3 bottom-post"><h3><a href="./basic-graph-traversal-in-ocaml.html">Basic Graph Traversal in OCaml</a><span> </span><span class="timestamp-wrapper"><span class="timestamp">(January 28, 2016)</span></span></h3>
<p>
This is my solution to Cracking The Coding Interview problem 4.2.
The problem is: Given a directed graph, design an algorithm to find out whether
there is a route between two nodes.
</p>

<p>
Keep in mind that I&rsquo;ve only been writing OCaml for a few weeks. There is
probably a more elegant solution. Once my OCaml is more advanced, I&rsquo;ll make a
new post. This solution does BFS traversal, returning <code>None</code> early when it can&rsquo;t
traverse any further and hasn&rsquo;t reached the destination node.
</p>

<div class="org-src-container">

<pre class="src src-ocaml"><span class="org-tuareg-font-lock-governing">module</span> <span class="org-tuareg-font-lock-module">Graph</span> <span class="org-tuareg-font-lock-operator">=</span>
<span class="org-tuareg-font-lock-governing">struct</span>
  <span class="org-tuareg-font-lock-governing">type</span> <span class="org-type">node</span>   <span class="org-tuareg-font-lock-operator">=</span> int
  <span class="org-tuareg-font-lock-governing">type</span> <span class="org-type">graph</span>  <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-1">{</span></span> nodes <span class="org-tuareg-font-lock-operator">:</span> node list<span class="org-tuareg-font-lock-operator">;</span> edges <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-2">(</span></span>node<span class="org-tuareg-font-lock-operator">*</span>node<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-2">)</span></span> list <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-1">}</span></span>
  <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">mk</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-1">{</span></span> nodes<span class="org-tuareg-font-lock-operator">=</span><span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-2">[]</span></span> <span class="org-tuareg-font-lock-operator">;</span> edges<span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-2">[]</span></span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-1">}</span></span>

  <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">mk_outgoing</span><span class="org-variable-name"> g</span> <span class="org-tuareg-font-lock-operator">=</span>
    <span class="org-keyword">fun</span> <span class="org-variable-name">n</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
      <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">keep</span><span class="org-variable-name"> </span><span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-variable-name">left</span><span class="org-tuareg-font-lock-operator">,</span><span class="org-variable-name">_</span><span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-variable-name"> </span><span class="org-keyword">as</span><span class="org-variable-name"> edge</span><span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-1">)</span></span><span class="org-variable-name"> acc</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-keyword">if</span> left <span class="org-tuareg-font-lock-operator">=</span> n <span class="org-keyword">then</span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-1">[</span></span>edge<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-1">]</span></span> <span class="org-tuareg-font-lock-operator">@</span> acc <span class="org-keyword">else</span> acc <span class="org-tuareg-font-lock-governing">in</span>
      <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">next_to</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">List.</span>fold_right g.edges <span class="org-constant">~f</span><span class="org-tuareg-font-lock-operator">:</span>keep <span class="org-constant">~init</span><span class="org-tuareg-font-lock-operator">:</span><span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-1">[]</span></span> <span class="org-tuareg-font-lock-governing">in</span>
      <span class="org-tuareg-font-lock-module">Int.Set.</span>of_list <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-tuareg-font-lock-module">List.</span>map next_to <span class="org-constant">~f</span><span class="org-tuareg-font-lock-operator">:</span><span class="org-type">snd</span><span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-1">)</span></span>

  <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">bfs_traverse_until</span><span class="org-variable-name"> g root </span><span class="org-constant">~f</span><span class="org-tuareg-font-lock-operator">:</span><span class="org-variable-name">action</span> <span class="org-tuareg-font-lock-operator">=</span>
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">outgoing</span> <span class="org-tuareg-font-lock-operator">=</span> mk_outgoing g
    <span class="org-tuareg-font-lock-governing">and</span> <span class="org-variable-name">visited</span>  <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">Int.Set.</span>empty
    <span class="org-tuareg-font-lock-governing">and</span> <span class="org-variable-name">to_visit</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">Queue.</span>create <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-1">()</span></span> <span class="org-tuareg-font-lock-governing">in</span>
    <span class="org-tuareg-font-lock-module">Queue.</span>enqueue to_visit root<span class="org-tuareg-font-lock-operator">;</span>
    <span class="org-tuareg-font-lock-governing">let</span> <span class="org-tuareg-font-lock-governing">rec</span> <span class="org-function-name">loop</span><span class="org-variable-name"> visited</span> <span class="org-tuareg-font-lock-operator">=</span>
      <span class="org-tuareg-font-lock-module">Option.</span>value_map
        <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-tuareg-font-lock-module">Queue.</span>dequeue to_visit<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-1">)</span></span>
        <span class="org-constant">~default</span><span class="org-tuareg-font-lock-operator">:</span><span class="org-tuareg-font-lock-constructor">None</span>
        <span class="org-constant">~f</span><span class="org-tuareg-font-lock-operator">:</span><span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-1">(</span></span><span class="org-keyword">fun</span> <span class="org-variable-name">id</span> <span class="org-tuareg-font-lock-operator">-&gt;</span>
            <span class="org-keyword">if</span> action id <span class="org-keyword">then</span> <span class="org-tuareg-font-lock-constructor">Some</span> id
            <span class="org-keyword">else</span> <span class="org-tuareg-font-lock-governing">begin</span>
              <span class="org-keyword">if</span> <span class="org-tuareg-font-lock-operator">not</span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-tuareg-font-lock-module">Int.Set.</span>mem visited id<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-2">)</span></span> <span class="org-keyword">then</span>
                <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">children</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">Int.Set.</span>diff <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-2">(</span></span>outgoing id<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-2">)</span></span> visited <span class="org-tuareg-font-lock-governing">in</span>
                <span class="org-tuareg-font-lock-module">Int.Set.</span>iter children <span class="org-constant">~f</span><span class="org-tuareg-font-lock-operator">:</span><span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-keyword">fun</span> <span class="org-variable-name">n</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> <span class="org-tuareg-font-lock-module">Queue.</span>enqueue to_visit n<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-tuareg-font-lock-operator">;</span>
                <span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">visited'</span> <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-module">Int.Set.</span>add visited id <span class="org-tuareg-font-lock-governing">in</span>
                loop visited'
              <span class="org-keyword">else</span>
                loop visited
            <span class="org-tuareg-font-lock-governing">end</span>
          <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-1">)</span></span>
    <span class="org-tuareg-font-lock-governing">in</span> loop visited

  <span class="org-tuareg-font-lock-governing">let</span> <span class="org-function-name">route</span><span class="org-variable-name"> g n1 n2</span> <span class="org-tuareg-font-lock-operator">=</span>
    <span class="org-tuareg-font-lock-module">Option.</span>is_some <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-1">(</span></span>bfs_traverse_until g n1 <span class="org-constant">~f</span><span class="org-tuareg-font-lock-operator">:</span><span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-2">(</span></span><span class="org-keyword">fun</span> <span class="org-variable-name">node</span> <span class="org-tuareg-font-lock-operator">-&gt;</span> node <span class="org-tuareg-font-lock-operator">=</span> n2<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-2">)</span></span><span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-1">)</span></span>
<span class="org-tuareg-font-lock-governing">end</span>

<span class="org-tuareg-font-lock-governing">let</span> <span class="org-variable-name">my_graph</span> <span class="org-tuareg-font-lock-operator">:</span> <span class="org-tuareg-font-lock-module">Graph.</span><span class="org-type">graph </span><span class="org-tuareg-font-lock-operator">=</span>
  <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-1">{</span></span> <span class="org-tuareg-font-lock-module">Graph.</span>nodes <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-2">[</span></span>1<span class="org-tuareg-font-lock-operator">;</span>2<span class="org-tuareg-font-lock-operator">;</span>3<span class="org-tuareg-font-lock-operator">;</span>4<span class="org-tuareg-font-lock-operator">;</span>5<span class="org-tuareg-font-lock-operator">;</span>6<span class="org-tuareg-font-lock-operator">;</span>7<span class="org-tuareg-font-lock-operator">;</span>8<span class="org-tuareg-font-lock-operator">;</span>9<span class="org-tuareg-font-lock-operator">;</span>10<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-2">]</span></span>
  <span class="org-tuareg-font-lock-operator">;</span> <span class="org-tuareg-font-lock-module">Graph.</span>edges <span class="org-tuareg-font-lock-operator">=</span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-2">[</span></span><span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>1<span class="org-tuareg-font-lock-operator">,</span>2<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>1<span class="org-tuareg-font-lock-operator">,</span>3<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>1<span class="org-tuareg-font-lock-operator">,</span>5<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>1<span class="org-tuareg-font-lock-operator">,</span>8<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>1<span class="org-tuareg-font-lock-operator">,</span>9<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span>
                  <span class="org-tuareg-font-lock-operator">;</span><span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>2<span class="org-tuareg-font-lock-operator">,</span>3<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>2<span class="org-tuareg-font-lock-operator">,</span>10<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>2<span class="org-tuareg-font-lock-operator">,</span>7<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span>
                  <span class="org-tuareg-font-lock-operator">;</span><span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>3<span class="org-tuareg-font-lock-operator">,</span>8<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span>
                  <span class="org-tuareg-font-lock-operator">;</span><span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>4<span class="org-tuareg-font-lock-operator">,</span>6<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>4<span class="org-tuareg-font-lock-operator">,</span>10<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span>
                  <span class="org-tuareg-font-lock-operator">;</span><span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>5<span class="org-tuareg-font-lock-operator">,</span>4<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>5<span class="org-tuareg-font-lock-operator">,</span>6<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span>
                  <span class="org-tuareg-font-lock-operator">;</span><span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>6<span class="org-tuareg-font-lock-operator">,</span>3<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span>
                  <span class="org-tuareg-font-lock-operator">;</span><span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>7<span class="org-tuareg-font-lock-operator">,</span>8<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>7<span class="org-tuareg-font-lock-operator">,</span>10<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>7<span class="org-tuareg-font-lock-operator">,</span>1<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span>
                  <span class="org-tuareg-font-lock-operator">;</span><span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>8<span class="org-tuareg-font-lock-operator">,</span>9<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>8<span class="org-tuareg-font-lock-operator">,</span>6<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span>
                  <span class="org-tuareg-font-lock-operator">;</span><span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>9<span class="org-tuareg-font-lock-operator">,</span>6<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>9<span class="org-tuareg-font-lock-operator">,</span>3<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span>
                  <span class="org-tuareg-font-lock-operator">;</span><span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>10<span class="org-tuareg-font-lock-operator">,</span>9<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tuareg-font-lock-operator">;</span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">(</span></span>10<span class="org-tuareg-font-lock-operator">,</span>8<span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-3">)</span></span><span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-2">]</span></span> <span class="org-tuareg-font-lock-operator"><span class="org-rainbow-delimiters-depth-1">}</span></span>
</pre>
</div>

<p>
Here&rsquo;s how I tested it:
</p>
<pre class="example">
utop[2]&gt; Graph.route;;
- : Graph.graph -&gt; int -&gt; int -&gt; bool = &lt;fun&gt;
utop[4]&gt; Graph.route my_graph 1 10;;
- : bool = true
utop[5]&gt; Graph.route my_graph 10 1;;
- : bool = false
utop[6]&gt; Graph.route my_graph 3 9;;
- : bool = true
utop[7]&gt; Graph.route my_graph 4 7;;
- : bool = false
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<a href="archive.html">Archive</a>
</div>
</body>
</html>
